# syntax=docker/dockerfile:1.4
# Development Dockerfile for faster iteration
FROM rust:1.88-slim as development

# Install development dependencies
RUN apt-get update && apt-get install -y \
    pkg-config \
    libssl-dev \
    libpq-dev \
    postgresql-client \
    curl \
    wget \
    && rm -rf /var/lib/apt/lists/*

# Install useful development tools with BuildKit cache mounts
RUN --mount=type=cache,target=/usr/local/cargo/registry \
    cargo install diesel_cli --no-default-features --features postgres && \
    cargo install bacon --locked

WORKDIR /app

# Copy manifests only - actual source is mounted as volume
COPY backend/Cargo.toml backend/Cargo.lock ./

# Note: We don't pre-build here because target/ is mounted as a volume.
# The first run will compile everything, subsequent runs use cached artifacts.

# Set up for live reloading with bacon (modern cargo-watch replacement)
# Bacon provides better TUI and is actively maintained
ENV RUST_BACKTRACE=1
ENV RUST_LOG_STYLE=always
# Use bacon in headless mode for Docker (no TUI, just logs)
CMD ["bacon", "--headless", "run"] 